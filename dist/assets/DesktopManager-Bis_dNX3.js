import{u as q,a as e,j as a,s as S,b as R,F as T,g as B,k as H,d as J,l as Z}from"./index-BP8PmJG4.js";import{r as d}from"./react-vendor-DqtZkGaG.js";const K=({isOpen:k,onClose:v})=>{var z,_,$,L;const{user:r,signOut:h}=q(),[f,b]=d.useState("profile"),[l,m]=d.useState(!1),[g,s]=d.useState({type:"",text:""}),y=d.useRef(null),[n,w]=d.useState({fullName:((z=r==null?void 0:r.user_metadata)==null?void 0:z.full_name)||"",email:(r==null?void 0:r.email)||"",avatarUrl:((_=r==null?void 0:r.user_metadata)==null?void 0:_.avatar_url)||""}),[C,u]=d.useState({currentPassword:"",newPassword:"",confirmPassword:""}),P=async c=>{c.preventDefault(),m(!0),s({type:"",text:""});try{const{error:o}=await S.auth.updateUser({data:{full_name:n.fullName,avatar_url:n.avatarUrl}});if(o)throw o;s({type:"success",text:"¬°Perfil actualizado exitosamente!"})}catch(o){s({type:"error",text:o.message})}finally{m(!1)}},A=async c=>{if(c.preventDefault(),m(!0),s({type:"",text:""}),C.newPassword!==C.confirmPassword){s({type:"error",text:"Las contrase√±as no coinciden"}),m(!1);return}if(C.newPassword.length<6){s({type:"error",text:"La contrase√±a debe tener al menos 6 caracteres"}),m(!1);return}try{const{error:o}=await S.auth.updateUser({password:C.newPassword});if(o)throw o;s({type:"success",text:"¬°Contrase√±a actualizada exitosamente!"}),u({currentPassword:"",newPassword:"",confirmPassword:""})}catch(o){s({type:"error",text:o.message})}finally{m(!1)}},U=async c=>{const o=c.target.files[0];if(o){if(!o.type.match("image.*")){s({type:"error",text:"Por favor, sube un archivo de imagen v√°lido (JPEG, PNG, etc.)"});return}if(o.size>5*1024*1024){s({type:"error",text:"La imagen es demasiado grande. El tama√±o m√°ximo permitido es de 5MB."});return}m(!0),s({type:"",text:""});try{const x=o.name.split(".").pop(),M=`avatar-${r.id}-${Date.now()}.${x}`,{data:t,error:i}=await S.storage.from("avatars").upload(M,o,{cacheControl:"3600",upsert:!0,contentType:o.type});if(i)throw i;const{data:{publicUrl:p}}=S.storage.from("avatars").getPublicUrl(M),{data:N,error:D}=await S.auth.updateUser({data:{...r.user_metadata,avatar_url:p}});if(D)throw D;w(I=>({...I,avatarUrl:p+"?t="+Date.now()}));const{data:{user:G},error:O}=await S.auth.getUser();if(O)throw O;s({type:"success",text:"¬°Foto de perfil actualizada correctamente!"})}catch(x){let E="Error al subir la imagen. Por favor, int√©ntalo de nuevo.";x.statusCode===403?E="Error de permisos. Aseg√∫rate de que el bucket tenga las pol√≠ticas de seguridad configuradas correctamente.":x.message.includes("bucket")&&(E="Error de configuraci√≥n del almacenamiento. Por favor, verifica que el bucket exista y tenga los permisos adecuados."),s({type:"error",text:E})}finally{m(!1)}}},F=async()=>{window.confirm("¬øEst√°s seguro de que quieres cerrar sesi√≥n?")&&(await h(),v())};return k?e("div",{className:"account-settings-overlay",children:a("div",{className:"account-settings-modal",children:[a("div",{className:"modal-header",children:[e("h2",{children:"Configuraci√≥n de Cuenta"}),e("button",{className:"close-btn",onClick:v,children:"√ó"})]}),a("div",{className:"modal-content",children:[a("div",{className:"tabs",children:[e("button",{className:`tab ${f==="profile"?"active":""}`,onClick:()=>b("profile"),children:"üë§ Perfil"}),e("button",{className:`tab ${f==="security"?"active":""}`,onClick:()=>b("security"),children:"üîí Seguridad"}),e("button",{className:`tab ${f==="account"?"active":""}`,onClick:()=>b("account"),children:"‚öôÔ∏è Cuenta"})]}),g.text&&e("div",{className:`message ${g.type}`,children:g.text}),f==="profile"&&e("div",{className:"tab-content",children:a("form",{onSubmit:P,children:[a("div",{className:"avatar-section",children:[e("div",{className:"avatar-preview",children:n.avatarUrl?e("img",{src:n.avatarUrl,alt:"Avatar"}):e("div",{className:"avatar-placeholder",children:(($=n.fullName)==null?void 0:$.charAt(0))||((L=r==null?void 0:r.email)==null?void 0:L.charAt(0))||"?"})}),e("button",{type:"button",className:"btn-secondary",onClick:()=>{var c;return(c=y.current)==null?void 0:c.click()},disabled:l,children:"Cambiar Foto"}),e("input",{ref:y,type:"file",accept:"image/*",onChange:U,style:{display:"none"}})]}),a("div",{className:"form-group",children:[e("label",{children:"Nombre Completo"}),e("input",{type:"text",value:n.fullName,onChange:c=>w(o=>({...o,fullName:c.target.value})),placeholder:"Tu nombre completo"})]}),a("div",{className:"form-group",children:[e("label",{children:"Email"}),e("input",{type:"email",value:n.email,disabled:!0,className:"disabled"}),e("small",{children:"El email no se puede cambiar por razones de seguridad"})]}),e("button",{type:"submit",className:"btn-primary",disabled:l,children:l?"Guardando...":"Guardar Cambios"})]})}),f==="security"&&e("div",{className:"tab-content",children:a("form",{onSubmit:A,children:[a("div",{className:"form-group",children:[e("label",{children:"Nueva Contrase√±a"}),e("input",{type:"password",value:C.newPassword,onChange:c=>u(o=>({...o,newPassword:c.target.value})),placeholder:"Nueva contrase√±a (m√≠n. 6 caracteres)",minLength:6})]}),a("div",{className:"form-group",children:[e("label",{children:"Confirmar Nueva Contrase√±a"}),e("input",{type:"password",value:C.confirmPassword,onChange:c=>u(o=>({...o,confirmPassword:c.target.value})),placeholder:"Confirma tu nueva contrase√±a",minLength:6})]}),e("button",{type:"submit",className:"btn-primary",disabled:l,children:l?"Actualizando...":"Cambiar Contrase√±a"})]})}),f==="account"&&a("div",{className:"tab-content",children:[a("div",{className:"account-info",children:[e("h3",{children:"Informaci√≥n de la Cuenta"}),a("p",{children:[e("strong",{children:"Email:"})," ",r==null?void 0:r.email]}),a("p",{children:[e("strong",{children:"ID de Usuario:"})," ",r==null?void 0:r.id]}),a("p",{children:[e("strong",{children:"Fecha de Registro:"})," ",new Date(r==null?void 0:r.created_at).toLocaleDateString()]})]}),a("div",{className:"danger-zone",children:[e("h3",{children:"Zona de Peligro"}),e("button",{className:"btn-danger",onClick:F,children:"Cerrar Sesi√≥n"})]})]})]})]})}):null},W=({showLogo:k=!0,title:v=null})=>{const{user:r}=q(),{subscription:h,isPremium:f}=R(),[b,l]=d.useState(!1);if(!r)return null;const m=()=>{var s,y;return((s=r==null?void 0:r.user_metadata)==null?void 0:s.full_name)||((y=r==null?void 0:r.email)==null?void 0:y.split("@")[0])||"Usuario"},g=()=>{var s;return(s=r==null?void 0:r.user_metadata)!=null&&s.avatar_url?r.user_metadata.avatar_url:null};return a(T,{children:[e("header",{className:"app-header",children:a("div",{className:"header-content",children:[a("div",{className:"header-left",children:[k&&e("div",{className:"logo",children:e("h1",{children:"Cozy Hours"})}),v&&e("div",{className:"page-title",children:e("h2",{children:v})})]}),a("div",{className:"header-right",children:[e("div",{className:`subscription-badge ${f()?"premium":"free"}`,children:f()?a(T,{children:[e("span",{className:"badge-icon",children:"‚ú®"}),e("span",{className:"badge-text",children:"Premium"})]}):a(T,{children:[e("span",{className:"badge-icon",children:"üÜì"}),e("span",{className:"badge-text",children:"Gratuito"})]})}),a("button",{className:"user-profile-btn",onClick:()=>l(!0),title:"Configuraci√≥n de cuenta",children:[g()?e("img",{src:g(),alt:"Avatar",className:"user-avatar"}):e("div",{className:"user-avatar-placeholder",children:m().charAt(0).toUpperCase()}),e("span",{className:"user-name",children:m()}),e("span",{className:"dropdown-arrow",children:"‚öôÔ∏è"})]})]})]})}),e(K,{isOpen:b,onClose:()=>l(!1)})]})},j=[{id:"happy",name:"Feliz",emoji:"üòä",color:"#FFD700"},{id:"focused",name:"Concentrado",emoji:"üéØ",color:"#4A90E2"},{id:"relaxed",name:"Relajado",emoji:"üòå",color:"#7ED321"},{id:"energetic",name:"Energetico",emoji:"‚ö°",color:"#FF6B35"},{id:"creative",name:"Creativo",emoji:"üé®",color:"#9013FE"},{id:"calm",name:"Calmado",emoji:"üßò",color:"#50E3C2"}],X=({onDesktopSelect:k,currentDesktop:v,onDesktopUpdate:r})=>{const[h,f]=d.useState([]),[b,l]=d.useState(!0),[m,g]=d.useState(!1),[s,y]=d.useState(null),[n,w]=d.useState({name:"",emotional_state:"happy",theme_color:"#FFD700"}),[C,u]=d.useState(""),{user:P}=q(),{canCreateMore:A,getLimit:U,isPremium:F,upgradeToPremium:z}=R();d.useEffect(()=>{_()},[P]);const _=async()=>{if(P)try{l(!0);const{data:t,error:i}=await B(P.id);if(i)throw i;f(t||[])}catch(t){u("Error al cargar escritorios: "+t.message)}finally{l(!1)}},$=async t=>{if(t.preventDefault(),!n.name.trim()){u("El nombre del escritorio es obligatorio");return}if(!A("desktops",h.length)){u(`El plan gratuito est√° limitado a ${U("desktops")} escritorios. ¬°Actualiza a Premium para obtener escritorios ilimitados!`);return}try{l(!0);const i=j.find(G=>G.id===n.emotional_state),p={user_id:P.id,name:n.name.trim(),emotional_state:n.emotional_state,theme_color:i.color,music_type:E(n.emotional_state),is_active:!1},{data:N,error:D}=await J(p);if(D)throw D;await _(),g(!1),w({name:"",emotional_state:"happy",theme_color:"#FFD700"}),u("")}catch(i){u("Error al crear el escritorio: "+i.message)}finally{l(!1)}},L=async t=>{if(t.preventDefault(),!(!n.name.trim()||!s))try{l(!0);const i=j.find(D=>D.id===n.emotional_state),p={name:n.name.trim(),emotional_state:n.emotional_state,theme_color:i.color,music_type:E(n.emotional_state)},{error:N}=await H(s.id,p);if(N)throw N;await _(),r&&await r(),y(null),w({name:"",emotional_state:"happy",theme_color:"#FFD700"}),u("")}catch(i){u("Error al actualizar el escritorio: "+i.message)}finally{l(!1)}},c=async t=>{if(window.confirm(`Estas seguro de eliminar "${t.name}"?`))try{l(!0);const{error:i}=await Z(t.id);if(i)throw i;if(await _(),v&&v.id===t.id){const p=h.filter(N=>N.id!==t.id);p.length>0&&k(p[0])}}catch(i){u("Error al eliminar el escritorio: "+i.message)}finally{l(!1)}},o=t=>{y(t),w({name:t.name,emotional_state:t.emotional_state,theme_color:t.theme_color}),g(!1)},x=()=>{y(null),w({name:"",emotional_state:"happy",theme_color:"#FFD700"})},E=t=>({focused:"ambient",energetic:"electronic",calm:"nature",happy:"jazz",creative:"jazz",relaxed:"lofi"})[t]||"lofi",M=t=>j.find(i=>i.id===t)||j[0];return b&&h.length===0?e("div",{className:"desktop-manager",children:e("div",{className:"loading-spinner",children:"Cargando escritorio..."})}):a("div",{className:"desktop-manager",children:[a("div",{className:"desktop-manager-header",children:[e("h2",{children:"Cambiar de escritorio"}),a("div",{className:"header-actions",children:[a("div",{className:"workspace-count",children:[a("span",{className:"count-text",children:[h.length,"/",F()?"‚àû":U("desktops")," Escritorios"]}),!F()&&e("span",{className:"plan-badge",children:"Plan gratuito"})]}),e("button",{className:"btn-create",onClick:()=>g(!0),disabled:!A("desktops",h.length),children:"+ Crear nuevo escritorio"})]}),!F()&&!A("desktops",h.length)&&a("div",{className:"limit-warning",children:[e("span",{children:"Alcanzaste el limite del plan gratuito"}),e("button",{className:"upgrade-btn-small",onClick:z,children:"Actualizar a premium"})]})]}),C&&a("div",{className:"error-message",children:[C,e("button",{onClick:()=>u(""),className:"error-close",children:"√ó"})]}),(m||s)&&e("div",{className:"desktop-form-overlay",children:a("div",{className:"desktop-form",children:[e("h3",{children:s?"Editar espacio de trabajo":"Crear nuevo espacio de trabajo"}),a("form",{onSubmit:s?L:$,children:[a("div",{className:"form-group",children:[e("label",{children:"Nombre de escritorio"}),e("input",{type:"text",value:n.name,onChange:t=>w({...n,name:t.target.value}),placeholder:"Ej: Escritorio para relajarme",required:!0})]}),a("div",{className:"form-group",children:[e("label",{children:"Estado emocional"}),e("div",{className:"emotion-grid",children:j.map(t=>a("div",{className:`emotion-option ${n.emotional_state===t.id?"selected":""}`,onClick:()=>w({...n,emotional_state:t.id,theme_color:t.color}),children:[e("span",{className:"emotion-emoji",children:t.emoji}),e("span",{className:"emotion-name",children:t.name})]},t.id))})]}),a("div",{className:"form-actions",children:[e("button",{type:"submit",className:"btn-primary",disabled:b,children:b?"Saving...":s?"Actualizar":"Crear"}),e("button",{type:"button",className:"btn-secondary",onClick:()=>{g(!1),x()},children:"Cancelar"})]})]})]})}),e("div",{className:"desktop-list-container",children:e("div",{className:"desktop-list",children:h.length===0?e("div",{className:"empty-state",children:e("p",{children:"No hay escritorios a√∫n! Crea uno"})}):h.map(t=>{const i=M(t.emotional_state),p=v&&v.id===t.id;return a("div",{className:`desktop-card ${p?"activo":""}`,style:{borderColor:i.color},children:[a("div",{className:"desktop-info",onClick:()=>k(t),children:[a("div",{className:"desktop-header",children:[e("span",{className:"desktop-emoji",children:i.emoji}),e("h3",{className:"desktop-name",children:t.name}),p&&e("span",{className:"active-badge",children:"Activar"})]}),a("p",{className:"desktop-emotion",children:["Modo ",i.name]}),a("p",{className:"desktop-date",children:["Creado ",new Date(t.created_at).toLocaleDateString()]})]}),a("div",{className:"desktop-actions",children:[e("button",{className:"btn-edit",onClick:N=>{N.stopPropagation(),o(t)},title:"Editar escritorio",children:"‚úèÔ∏è"}),e("button",{className:"btn-delete",onClick:N=>{N.stopPropagation(),c(t)},title:"Eliminar escritorio",disabled:h.length===1,children:"üóëÔ∏è"})]})]},t.id)})})})]})};export{W as A,X as D};
//# sourceMappingURL=DesktopManager-Bis_dNX3.js.map
