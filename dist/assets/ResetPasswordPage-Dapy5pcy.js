import{s as f,a as e,j as o,F as L}from"./index-BP8PmJG4.js";import{i as _,u as E,r as c,L as R}from"./react-vendor-DqtZkGaG.js";/* empty css                  */import"./supabase-ulL4C6uA.js";const j=()=>{const u=_(),N=E(),[p,w]=c.useState(!1),[n,i]=c.useState({type:"",text:""}),[r,P]=c.useState({password:"",confirmPassword:""}),[t,g]=c.useState({}),[v,k]=c.useState("");c.useEffect(()=>{const a=new URLSearchParams(u.search),s=a.get("type"),l=a.get("access_token"),d=a.get("refresh_token");if(!l&&u.hash){const h=new URLSearchParams(u.hash.substring(1)),m=h.get("access_token"),y=h.get("refresh_token");if(m){const C=`${window.location.pathname}?type=recovery&access_token=${m}`+(y?`&refresh_token=${y}`:"");window.location.replace(C);return}}s==="recovery"&&l?(window.history.replaceState({},document.title,window.location.pathname),f.auth.setSession({access_token:l,refresh_token:d||""}).then(({error:h})=>{if(h)i({type:"error",text:"El enlace de restablecimiento es inválido o ha expirado. Por favor, solicita uno nuevo."});else{const m=f.auth.user();m&&k(m.email)}})):i({type:"error",text:"No se encontró un enlace de restablecimiento válido. Por favor, solicita uno nuevo."})},[u]);const b=a=>{const{name:s,value:l}=a.target;P(d=>({...d,[s]:l})),t[s]&&g(d=>({...d,[s]:""}))},x=()=>{const a={};return r.password?r.password.length<6&&(a.password="La contraseña debe tener al menos 6 caracteres"):a.password="La contraseña es requerida",r.password!==r.confirmPassword&&(a.confirmPassword="Las contraseñas no coinciden"),g(a),Object.keys(a).length===0},S=async a=>{if(a.preventDefault(),!!x()){w(!0),i({type:"",text:""});try{const{error:s}=await f.auth.updateUser({password:r.password});if(s)throw s;await f.auth.signOut(),i({type:"success",text:"¡Tu contraseña ha sido actualizada correctamente! Redirigiendo al inicio de sesión..."}),setTimeout(()=>{N("/login",{state:{passwordUpdated:!0}})},3e3)}catch(s){i({type:"error",text:s.message||"Ocurrió un error al restablecer la contraseña. Por favor, inténtalo de nuevo."})}finally{w(!1)}}};return e("div",{className:"auth-page",children:o("div",{className:"auth-container",children:[o("div",{className:"auth-header",children:[e(R,{to:"/login",className:"back-link",children:"← Volver al inicio de sesión"}),e("h1",{className:"auth-title",children:"Restablecer Contraseña"}),e("p",{className:"auth-subtitle",children:n.type==="success"?n.text:v?`Establece una nueva contraseña para ${v}`:"Ingresa tu nueva contraseña para continuar."})]}),n.type!=="success"&&o("form",{className:"auth-form",onSubmit:S,children:[n.text&&e("div",{className:`message ${n.type==="error"?"error-message":"success-message"}`,children:n.text}),o("div",{className:"form-group",children:[e("label",{htmlFor:"password",className:"form-label",children:"Nueva Contraseña"}),e("input",{type:"password",id:"password",name:"password",value:r.password,onChange:b,className:`form-input ${t.password?"error":""}`,placeholder:"Ingresa tu nueva contraseña",disabled:p}),t.password&&e("span",{className:"field-error",children:t.password})]}),o("div",{className:"form-group",children:[e("label",{htmlFor:"confirmPassword",className:"form-label",children:"Confirmar Contraseña"}),e("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:r.confirmPassword,onChange:b,className:`form-input ${t.confirmPassword?"error":""}`,placeholder:"Confirma tu nueva contraseña",disabled:p}),t.confirmPassword&&e("span",{className:"field-error",children:t.confirmPassword})]}),e("button",{type:"submit",className:"btn btn-primary btn-full",disabled:p,children:p?o(L,{children:[e("span",{className:"loading-spinner"}),"Actualizando..."]}):"Actualizar Contraseña"})]}),e("div",{className:"auth-footer",children:o("p",{children:["¿Recordaste tu contraseña?"," ",e("a",{href:"/login",className:"auth-link",children:"Iniciar sesión"})]})})]})})};export{j as default};
//# sourceMappingURL=ResetPasswordPage-Dapy5pcy.js.map
