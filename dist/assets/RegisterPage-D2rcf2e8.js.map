{"version":3,"file":"RegisterPage-D2rcf2e8.js","sources":["../../src/pages/RegisterPage.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Link, useNavigate, useSearchParams } from 'react-router-dom';\nimport { useAuth } from '../contexts/AuthContext';\nimport { useSubscription } from '../contexts/SubscriptionContext';\nimport './AuthPages.css';\n\nconst RegisterPage = () => {\n  const [searchParams] = useSearchParams();\n  const [formData, setFormData] = useState({\n    email: '',\n    password: '',\n    confirmPassword: ''\n  });\n  const [errors, setErrors] = useState({});\n  const [loading, setLoading] = useState(false);\n  const [showTrialOption, setShowTrialOption] = useState(false);\n  const [trialSelected, setTrialSelected] = useState(false);\n  const { signUp } = useAuth();\n  const { startPremiumTrial } = useSubscription();\n  const navigate = useNavigate();\n\n  const handleChange = (e) => {\n    const { name, value } = e.target;\n    setFormData(prev => ({\n      ...prev,\n      [name]: value\n    }));\n    // Limpiar error cuando el usuario comienza a escribir\n    if (errors[name]) {\n      setErrors(prev => ({\n        ...prev,\n        [name]: ''\n      }));\n    }\n  };\n\n  const validateForm = () => {\n    const newErrors = {};\n\n    if (!formData.email) {\n      newErrors.email = 'Se requiere correo electrónico';\n    } else if (!/\\S+@\\S+\\.\\S+/.test(formData.email)) {\n      newErrors.email = 'El correo electrónico no es válido';\n    }\n\n    if (!formData.password) {\n      newErrors.password = 'Se requiere contraseña';\n    } else if (formData.password.length < 6) {\n      newErrors.password = 'La contraseña debe tener al menos 6 caracteres';\n    }\n\n    if (!formData.confirmPassword) {\n      newErrors.confirmPassword = 'Por favor confirma tu contraseña';\n    } else if (formData.password !== formData.confirmPassword) {\n      newErrors.confirmPassword = 'Las contraseñas no coinciden';\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    \n    if (!validateForm()) return;\n    if (showTrialOption && !trialSelected) return;\n\n    setLoading(true);\n    setErrors({});\n\n    try {\n      // Primero creamos el usuario\n      const { data, error } = await signUp(formData.email, formData.password);\n      \n      // Si hay un error, lo manejamos\n      if (error) {\n        console.log('Error de registro:', error); // Para depuración\n        \n        if (error.message && (error.message.includes('ya está registrado') || \n                             error.message.includes('already registered') || \n                             error.message.includes('already in use') ||\n                             error.message.includes('ya está en uso'))) {\n          setErrors({ \n            general: 'Este correo electrónico ya está registrado. Por favor, inicia sesión o utiliza otro correo.' \n          });\n        } else if (error.message && error.message.includes('La contraseña debe tener al menos 6 caracteres')) {\n          setErrors({ password: 'La contraseña debe tener al menos 6 caracteres' });\n        } else {\n          setErrors({ \n            general: error.message || 'Ocurrió un error al registrar el usuario. Por favor, inténtalo de nuevo.' \n          });\n        }\n        setLoading(false);\n        return;\n      }\n      \n      // Si no hay error, continuamos con el flujo normal\n      console.log('Registro exitoso, datos:', data); // Para depuración\n\n      // Si el usuario seleccionó la prueba premium, la activamos\n      if (trialSelected) {\n        startPremiumTrial();\n      }\n\n      // Registro exitoso, redirigir a la configuración emocional\n      navigate('/emotional-setup');\n    } catch (error) {\n      console.error('Error durante el registro:', error);\n      setErrors({ general: 'Se produjo un error inesperado. Inténtalo de nuevo.' });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"auth-page\">\n      <div className=\"auth-container\">\n        <div className=\"auth-header\">\n          <Link to=\"/\" className=\"back-link\">\n            ← Volver a Inicio\n          </Link>\n          <h1 className=\"auth-title\">Crea tu cuenta</h1>\n          <p className=\"auth-subtitle\">Únete a Cozy Hours y comienza tu viaje de productividad emocional</p>\n        </div>\n\n        <form className=\"auth-form\" onSubmit={handleSubmit}>\n          {errors.general && (\n            <div className=\"error-message\">\n              {errors.general}\n            </div>\n          )}\n\n          <div className=\"form-group\">\n            <label htmlFor=\"email\" className=\"form-label\">Email</label>\n            <input\n              type=\"email\"\n              id=\"email\"\n              name=\"email\"\n              value={formData.email}\n              onChange={handleChange}\n              className={`form-input ${errors.email ? 'error' : ''}`}\n              placeholder=\"Escribe tu email\"\n              disabled={loading}\n            />\n            {errors.email && <span className=\"field-error\">{errors.email}</span>}\n          </div>\n\n          <div className=\"form-group\">\n            <label htmlFor=\"password\" className=\"form-label\">Contraseña</label>\n            <input\n              type=\"password\"\n              id=\"password\"\n              name=\"password\"\n              value={formData.password}\n              onChange={handleChange}\n              className={`form-input ${errors.password ? 'error' : ''}`}\n              placeholder=\"Crear contraseña (min. 6 caracteres)\"\n              disabled={loading}\n            />\n            {errors.password && <span className=\"field-error\">{errors.password}</span>}\n          </div>\n\n          <div className=\"form-group\">\n            <label htmlFor=\"confirmPassword\" className=\"form-label\">Confirmar Contraseña</label>\n            <input\n              type=\"password\"\n              id=\"confirmPassword\"\n              name=\"confirmPassword\"\n              value={formData.confirmPassword}\n              onChange={handleChange}\n              className={`form-input ${errors.confirmPassword ? 'error' : ''}`}\n              placeholder=\"Confirmar contraseña\"\n              disabled={loading}\n            />\n            {errors.confirmPassword && <span className=\"field-error\">{errors.confirmPassword}</span>}\n          </div>\n\n          <button \n            type=\"submit\" \n            className=\"btn btn-primary btn-full\"\n            disabled={loading}\n          >\n            {loading ? (\n              <>\n                <span className=\"loading-spinner\"></span>\n                Creando cuenta...\n              </>\n            ) : (\n              'Crear cuenta'\n            )}\n          </button>\n        </form>\n\n        <div className=\"auth-footer\">\n          <p>\n           ¿Ya tienes una cuenta?{' '}\n            <Link to=\"/login\" className=\"auth-link\">\n              Inicie sesión aquí\n            </Link>\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default RegisterPage;\n"],"names":["RegisterPage","useSearchParams","formData","setFormData","useState","email","password","confirmPassword","errors","setErrors","loading","setLoading","showTrialOption","setShowTrialOption","trialSelected","setTrialSelected","signUp","useAuth","startPremiumTrial","useSubscription","navigate","useNavigate","handleChange","e","name","value","target","prev","validateForm","newErrors","test","length","Object","keys","jsxs","jsx","Link","preventDefault","data","error","message","includes","general","Fragment"],"mappings":"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"}