import{u as A,b as P,g as B,j as t,a as e,F as H,c as L,d as M}from"./index-BP8PmJG4.js";import{r as o,u as U}from"./react-vendor-DqtZkGaG.js";import{A as $,D as q}from"./DesktopManager-Bis_dNX3.js";import"./supabase-ulL4C6uA.js";const G=[{id:"happy",name:"Feliz",emoji:"😊",color:"#FFD700"},{id:"focused",name:"Enfocado",emoji:"🎯",color:"#4A90E2"},{id:"relaxed",name:"Relajado",emoji:"😌",color:"#7ED321"},{id:"energetic",name:"Energetico",emoji:"⚡",color:"#FF6B35"},{id:"creative",name:"Creativo",emoji:"🎨",color:"#9013FE"},{id:"calm",name:"Calmado",emoji:"🧘",color:"#50E3C2"}],K=()=>{const[s,j]=o.useState(null),[r,p]=o.useState(""),[c,u]=o.useState(!1),[h,d]=o.useState(""),[w,g]=o.useState(!1),[y,D]=o.useState([]),[f,E]=o.useState(!1),{user:i}=A(),{isFirstLogin:S,resetFirstLoginFlag:R}=P(),v=U();o.useEffect(()=>{F()},[i]);const F=async()=>{if(i)try{const{data:a,error:n}=await B(i.id);if(n)throw n;D(a||[]),E((a||[]).length>0)}catch{}},x=a=>{v("/dashboard")},C=a=>{j(a),r||p(`escritorio ${a.name}`)},_=async a=>{var n,N,k;if(a.preventDefault(),!s||!r.trim()){d("Please select an emotional state and enter a desktop name");return}u(!0),d("");try{const m={id:i.id,email:i.email,full_name:((n=i.user_metadata)==null?void 0:n.full_name)||((N=i.email)==null?void 0:N.split("@")[0])||"User",avatar_url:((k=i.user_metadata)==null?void 0:k.avatar_url)||null},{error:l}=await L(i.id,m);if(l&&!l.message.includes("duplicate key")&&!l.message.includes("already exists"))throw new Error("Failed to create user profile: "+l.message);const z={user_id:i.id,name:r.trim(),emotional_state:s.id,theme_color:s.color,music_type:s.id==="focused"?"ambient":s.id==="energetic"?"electronic":s.id==="calm"?"nature":s.id==="happy"||s.id==="creative"?"jazz":"lofi",is_active:!0},{error:b}=await M(z);if(b)throw new Error("Failed to create desktop: "+b.message);v("/dashboard")}catch(m){d(m.message)}finally{u(!1)}};return t("div",{className:"emotional-setup-page",children:[e($,{title:"Configuración de Espacio de Trabajo"}),t("div",{className:"setup-container",children:[t("div",{className:"setup-header",children:[e("h1",{className:"setup-title",children:"¡Bienvenido a Cozy Hours!"}),S&&t("div",{className:"first-login-welcome",children:[t("div",{className:"welcome-badge",children:["🎉 ¡Bienvenido! Estás comenzando con el ",e("strong",{children:"Plan Gratuito"})]}),e("p",{className:"welcome-details",children:"Puedes crear hasta 3 espacios de trabajo, 10 tareas y 5 notas. ¡Actualiza a Premium cuando quieras para acceso ilimitado!"})]}),e("p",{className:"setup-subtitle",children:f?"Crea un nuevo espacio de trabajo o administra los existentes":"Elige tu estado emocional actual para crear tu espacio de trabajo personalizado"}),f&&e("div",{className:"workspace-options",children:t("button",{type:"button",className:"btn-manage-workspaces",onClick:()=>g(!0),children:["🖥️ Administrar espacios de trabajo existentes (",y.length,")"]})})]}),t("form",{className:"setup-form",onSubmit:_,children:[h&&e("div",{className:"error-message",children:h}),e("div",{className:"emotional-states",children:G.map(a=>t("div",{className:`state-option ${(s==null?void 0:s.id)===a.id?"selected":""}`,onClick:()=>C(a),children:[e("div",{className:"state-emoji",children:a.emoji}),e("p",{className:"state-name",children:a.name})]},a.id))}),t("div",{className:"form-group",children:[e("label",{htmlFor:"desktopName",className:"form-label",children:"Nombra tu espacio de trabajo"}),e("input",{type:"text",id:"desktopName",value:r,onChange:a=>p(a.target.value),className:"form-input",placeholder:"Ej: Felizuwu",disabled:c})]}),s&&r&&t("div",{className:"desktop-preview",children:[e("h3",{className:"preview-title",children:"Vista previa"}),t("div",{className:"preview-content",children:[e("span",{className:"preview-emoji",children:s.emoji}),e("span",{className:"preview-text",children:r})]})]}),e("div",{className:"setup-actions",style:{display:"flex",justifyContent:"center"},children:e("button",{type:"submit",className:"btn-primary",disabled:c||!s||!r.trim(),onClick:a=>{},children:c?t(H,{children:[e("span",{className:"loading-spinner"}),"Creando tu espacio..."]}):"Crear mi escritorio"})})]})]}),w&&e("div",{className:"desktop-manager-overlay",children:t("div",{className:"desktop-manager-container",children:[e("button",{className:"close-desktop-manager",onClick:()=>g(!1),children:"×"}),e(q,{onDesktopSelect:x,currentDesktop:null})]})})]})};export{K as default};
//# sourceMappingURL=EmotionalSetupPage-Cb7Id295.js.map
